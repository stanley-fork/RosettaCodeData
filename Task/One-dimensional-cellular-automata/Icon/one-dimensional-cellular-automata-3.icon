(function next cells
  (... str
    (map (comp str (count ["#"]) (= 2) #(% "#" "_"))
         "_{cells}"
         cells
         "{skip 1 cells}_")))

(function generate n cells
 (join "\n" (reductions next cells (range n))))
